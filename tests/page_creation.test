<?php
// $Id: page_creation.test,v 1.3 2005/08/31 13:55:59 thomasilsche Exp $
class PageCreationTest extends  DrupalTestCase {
  var $_cleanup_roles = array();
  var $_cleanup_users = array();
  
  /**
   * Implementation of get_info() for information
   */
  function get_info() {
    return array('name' => t('Page creation Test'), 'desc' => t('Creates a user that then creates a page and tries access to it') , 'group' => 'Node Tests');
  }

  function testPageCreation() {
    /* Prepare settings */
    $this->drupalVariableSet('node_options_page', array('status', 'promote'));
   
    /* Prepare a user to do the stuff */
    $user = $this->drupalCreateUserRolePerm(array('access content', 'create pages'));
    $this->drupalLoginUser($user);
    
    $edit = array();
    $edit['title']    = '!SimpleTest test node! ' . $this->randomName(10);
    $edit['body']     = '!SimpleTest test body! ' . $this->randomName(32) . ' ' . $this->randomName(32);
    $this->drupalPostRequest('node/add/page', $edit, 'Submit');
    $this->assertWantedText(t('Your %post was created.', array ('%post' => 'page')), 'Page created');
    
    $node = node_load(array('title' => $edit['title']));
    $this->assertNotNull($node, 'Node found in database');
    
    $this->assertWantedText($edit['title'], 'Page title found');
    $this->assertWantedText($edit['body'], 'Page body found');
    
    db_query('DELETE FROM {node} WHERE nid = %d', $node->nid);
  }
}
?>